--- ./external/archives/sparselm-1.3/Makefile_demo	2011-05-03 22:12:32.000000000 +0930
+++ ./external/working/sparselm-1.3/Makefile_demo	2017-12-12 19:47:52.324687114 +1030
@@ -3,14 +3,14 @@
 #
 
 CC=gcc
-GCCFLAGS=-O3 -Wall -ffast-math -funroll-all-loops
-MACH_CFLAGS=-march=pentiumpro -malign-double # machine specific gcc flags, in this case for the pentium pro
-#MACH_CFLAGS=-march=native -mtune=native
-
-CFLAGS=$(GCCFLAGS) $(MACH_CFLAGS) #-g
-#LAPACKLIBS=-L/opt/intel/mkl/8.0.1/lib/32/ -lmkl_solver -lmkl_lapack -lmkl_ia32 -lguide -lf2c # MKL 8.0.1 
-LAPACKLIBS=-llapack -lblas -lf2c # sometimes -lf2c is equivalent to -lF77 -lI77
-#LAPACKLIBS=-llapack -lgoto2 -lpthread -lf2c # GotoBLAS
+GCCFLAGS=-O3 -Wall -ffast-math -funroll-all-loops -msse3
+MACH_CFLAGS=-m64
+
+# Intel MKL root
+MKLROOT=/opt/intel/mkl
+
+CFLAGS=$(GCCFLAGS) $(MACH_CFLAGS) -I${MKLROOT}/include #-g
+LAPACKLIBS=-L${MKLROOT}/lib/intel64 -Wl,--no-as-needed -lmkl_intel_lp64 -lmkl_gnu_thread -lmkl_core -lgomp -lpthread -lm -ldl # MKL 2018
 
 SRCS=splmdemo.c
 OBJS=splmdemo.o
@@ -26,24 +26,24 @@
 SPARSELM_LIB=-L.
 
 ## libraries & file paths for sparse solver(s)
-SUITESPARSE_PATH=/home/lourakis/SuiteSparse-3.4.0
+SUITESPARSE_PATH=../SuiteSparse
 
-CSPARSE_LIB=-L$(SUITESPARSE_PATH)/CSparse/Lib
-LDL_LIB=-L$(SUITESPARSE_PATH)/LDL/Lib
-CHOLMOD_LIB=-L$(SUITESPARSE_PATH)/CHOLMOD/Lib
-PARDISO_LIB=-L/opt/intel/mkl/8.0.1/lib/32/ 
-UMFPACK_LIB=-L$(SUITESPARSE_PATH)/UMFPACK/Lib
+CSPARSE_LIB=-L$(SUITESPARSE_PATH)/lib
+LDL_LIB=-L$(SUITESPARSE_PATH)/lib
+CHOLMOD_LIB=-L$(SUITESPARSE_PATH)/lib
+PARDISO_LIB=-L${MKLROOT}/lib/intel64 -Wl,--no-as-needed -lmkl_intel_lp64 -lmkl_gnu_thread -lmkl_core -lgomp -lpthread -lm -ldl
+UMFPACK_LIB=-L$(SUITESPARSE_PATH)/lib
 SuperLU_LIB=-L/usr/local/include/slu
 TAUCS_LIB=-L/usr/local/include/
 SPOOLES_LIB=-L/home/lourakis/spooles.2.2/ -L/home/lourakis/spooles.2.2/LinSol/srcST/
 MUMPS_LIB=-L/home/lourakis/MUMPS_4.8.3/lib -L/home/lourakis/MUMPS_4.8.3/libseq -L/home/lourakis/MUMPS_4.8.3/PORD/lib
 MA77_LIB=
-MKL_LIB=-L/opt/intel/mkl/8.0.1/lib/32/
-UFconfig_LIB=-L$(SUITESPARSE_PATH)/UFconfig/
-AMD_LIB=-L$(SUITESPARSE_PATH)/AMD/Lib/
-COLAMD_LIB=-L$(SUITESPARSE_PATH)/COLAMD/Lib/
-CCOLAMD_LIB=-L$(SUITESPARSE_PATH)/CCOLAMD/Lib/
-CAMD_LIB=-L$(SUITESPARSE_PATH)/CAMD/Lib/
+MKL_LIB=-L${MKLROOT}/lib/intel64 -Wl,--no-as-needed -lmkl_intel_lp64 -lmkl_gnu_thread -lmkl_core -lgomp -lpthread -lm -ldl
+UFconfig_LIB=-L$(SUITESPARSE_PATH)/lib
+AMD_LIB=-L$(SUITESPARSE_PATH)/lib
+COLAMD_LIB=-L$(SUITESPARSE_PATH)/lib
+CCOLAMD_LIB=-L$(SUITESPARSE_PATH)/lib
+CAMD_LIB=-L$(SUITESPARSE_PATH)/lib
 METIS_LIB=-L/usr/local/lib/
 
 ######## No changes should be necessary beyond this point ########
@@ -82,7 +82,7 @@
 
 ifeq ($(strip $(HAVE_PARDISO)), yes)
   LDFL:=$(LDFL) $(PARDISO_LIB)
-  LIBS:=$(LIBS) -lmkl_solver -lmkl_lapack -lmkl_ia32 -lguide
+  LIBS:=$(LIBS) $(PARDISO_LIB)
 endif
 
 ifeq ($(strip $(HAVE_SuperLU)), yes)
@@ -121,7 +121,7 @@
 
 ifeq ($(strip $(HAVE_MKL)), yes)
   LDFL:=$(LDFL) $(MKL_LIB)
-  LIBS:=$(LIBS) -lmkl_solver -lmkl_lapack -lmkl_ia32 -lguide -lf2c
+  LIBS:=$(LIBS) $(MKL_LIB)
 endif
 
 
